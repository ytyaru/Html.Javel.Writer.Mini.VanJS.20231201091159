# 画面遷移

1. メイン画面（本文編集閲覧＋メニュー）
2. メタ情報編集
3. 設定
4. 情報

## 1. メイン画面（本文編集閲覧＋メニュー）

```
+------------------+--+------------------+
|Textarea          |題|HtmlViewer        |
|                  |字|                  |
|                  |縦|                  |
|                  |黒|                  |
|                  |出|                  |
|                  |？|                  |
|原稿を入力する    |時|原稿をHTML表示する|
+------------------+--+------------------+
```

```
+------------------+--+------------------+
|表紙編集(題章字)  |縦|HtmlViewer        |
+------------------+黒|                  |
|本文編集Textarea  |出|                  |
|                  |？|                  |                  |
|                  |  |                  |
|                  |  |
|原稿を入力する    |時|原稿をHTML表示する|
+------------------+--+------------------+
```


## 2. メタ情報編集

1. 表紙
    1. 作品
        1. 著者
        2. デフォルト表示設定（書字方向,配色）
    2. テンプレート

```
+------------------+------------------+
|表紙Editor        |HtmlViewer        |
|表題[    ]残今字  |                  |
|...               |                  |
|著者[山田太郎▼]  |                  |
|                  |                  |
|                  |                  |
|メイン画面へ戻る  |表紙をHTML表示する|
+------------------+------------------+
```
```
+------------------+------------------+
|著者Editor        |HtmlViewer        |
|名[山田太郎▼][＋]|                  |
|github  [username]|                  |
|mstdn.jp[username]|                  |
|mona    [address] |                  |
|                  |                  |
|[保存]            |                  |
|メイン画面へ戻る  |表紙をHTML表示する|
+------------------+------------------+
```
```
+------------------+------------------+
|テンプレEditor    |HtmlViewer        |
|表題[    ]残今字  |                  |
|...               |                  |
|本文[    ]800字迄 |                  |
|                  |                  |
|著者[山田太郎▼]  |                  |
|                  |                  |
|[保存]            |                  |
|                  |                  |
|メイン画面へ戻る  |表紙をHTML表示する|
+------------------+------------------+
```

　シンプルに一画面にしたい。でも当該作品なのかテンプレなのか指定して編集せねばならない。また、テンプレは本文や保存ボタンも含めたい。ほぼ同じなのに微妙に違うから困る。

```
+------------------+------------------+
|[表紙|テンプレ▼] |HtmlViewer        |
|表題[    ]残今字  |                  |
|...               |                  |
|本文[    ]800字迄 |                  |
|                  |                  |
|著者[山田太郎▼]  |                  |
|                  |                  |
|                  |                  |
|メイン画面へ戻る  |表紙をHTML表示する|
+------------------+------------------+
```

　本文と表紙は本文エディタでDownloadボタンを押すことでファイルとしてダウンロードする。作品ごとに個別の内容になる。
　テンプレは保存ボタンでIndexedDBに保存する。起動する時の初期値になる。

## 3. 設定

```
```

## 4. 情報

```
```

# 構造

1. 秘密情報を入力する
2. 秘密情報をハードコーディングしたソースを生成する（yamlファイル化も可）
3. 2を使って作品を書く

　ブラウザ保存機構(Cookie,LocalStorage,IndexedDB)を使うとXSSによるセキュリティ危機がある。そこで秘密情報をアプリのソースコードにハードコーディングすることで対策する。

　秘密情報を変更するときは面倒な手続きが必要になる。変更があるたびにJavel生成アプリで秘密情報を入力し、Javelアプリを生成し、アプリファイルを上書き保存せねばならない。

　作品はさらに面倒。ファイルをダウンロードし、変更があるたびJavelアプリへファイルをDnDし、終わったらダウンロードし、上書き保存せねばならない。

　対案としては、ハードコーディングされたUUID等をキーにして、作品の本文を暗号化したテキストをIndexedDBに保存すること。これならXSS攻撃されても復号化に必要なキーはソースコード本文にあるため盗まれても盗作されない。欠点は本文検索できないこと。検索にタイトルを用いるならタイトルは盗作されてしまうこと。

```
+---------------+→DL  →+------------+
|Javel生成アプリ|        |秘密情報YAML|
+---------------+ ←DnD←+------------+
      ↓Generate
+-----------+    →DL → +------------+
|Javelアプリ|            |作品JAVEL   |
+-----------+    ←DnD← +------------+
```

　公開するには作品JAVELファイルをアップロードすること。読者はこれをダウンロードし、JavelアプリにDnDして閲覧する。

```
+------------Local File System -----------+
| +---------------+→DL  →+------------+ |
| |Javel生成アプリ|        |秘密情報YAML| |
| +---------------+ ←DnD←+------------+ |
|       ↓Generate                        |
| +-----------+    →DL → +------------+ |
| |Javelアプリ|            |作品JAVEL   | |
| +-----------+    ←DnD← +------------+ |
+---↑------------------------------↓----+
+---DL----Internet Hosting Service--Up----+
|   ↑                              ↓    |
+-----------------------------------------+
```

　読むのも面倒くさい手間がいる。

　これを解決するにはいくつか方法がある。

* CORS制約内：Javelアプリで閲覧する（自分が管理するドメイン内にアプリとJAVELファイルが必要）
* CORS制約外：ブラウザ拡張機能で閲覧する（どのホストにあるJAVELファイルでも閲覧可）

　前者はCORS制約に阻まれてファイルアップローダにあるファイルを直接閲覧できない等の不便さがある。自前のドメイン内でファイル検索も含めて実装すれば直接閲覧できるが、他者のファイルはCORS制約に阻まれて閲覧できない。

　後者は専用ブラウザ拡張機能をインストールする必要がある。ブラウザ拡張機能APIの仕様変更やセキュリティなど対応を迫られる恐れがある。

　あとはElectronやpiwebviewなどを使ってローカルファイルとのやりとりを可能にする。

* https://qiita.com/TBjustice/items/d9277003f483cff1bdd6













秘密情報埋込

* yamlファイル化してDnDしUIで編集してダウンロードしyamlファイルを上書きする

* 秘密情報には

