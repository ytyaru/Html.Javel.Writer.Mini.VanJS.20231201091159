# 画面＆機能

```
+------------------+------------------+
|Textarea          |HtmlViewer        |
|                  |                  |
|原稿を入力する    |原稿をHTML表示する|
+------------------+------------------+
```

```
+------------------+--+------------------+
|Textarea          |縦|HtmlViewer        |
|                  |黒|                  |
|原稿を入力する    |出|原稿をHTML表示する|
+------------------+--|------------------+
```
```
+------------------+--+------------------+
|Textarea          |題|HtmlViewer        |
|                  |縦|                  |
|                  |黒|                  |
|原稿を入力する    |出|原稿をHTML表示する|
+------------------+--|------------------+
```


ボタン|概要
------|----
`題`|メタデータ編集（タイトル等）
`縦`|書字方向切替（縦／横）
`黒`|配色切替（白／黒）
`出`|ファイルダウンロード

　ボタン数が増えるとフォーカス遷移が面倒になる。そこで機能ボタンは平時すべて隠蔽しておく。

```
+------------------+------------------+
|Textarea          |HtmlViewer        |
|                  |                  |
|原稿を入力する    |原稿をHTML表示する|
+------------------+------------------+
```

　`ESC`キー押下された時だけ機能ボタンがポップアップする。（スマホの時は？）

```
+------------------+------------------+
|Textarea          |HtmlViewer        |
|    +---------------------------+    |
|    |   |縦横|  |白黒|  |入出|  |    |
|    +---------------------------+    |
|原稿を入力する    |原稿をHTML表示する|
+------------------+------------------+
```

　`F1`キー押下したらヘルプ表示する。（スマホの時は？）

+------------------+------------------+
|Textarea          |HtmlViewer        |
|    +---------------------------+    |
|    |Javel Writer v1.0.0 🐙 L Ⓜ|    |
|    |                           |    |
|    |これは簡易構文テキストから |    |
|    |小説を作成するアプリです。 |    |
|    +---------------------------+    |
|原稿を入力する    |原稿をHTML表示する|
+------------------+------------------+

機能|概要
----|----
`🐙`|GitHubリポジトリへのリンク
`L`|ライセンス表示（`AGPLv3`等）
`Ⓜ`|寄付（著者への投げ銭（暗号通貨モナコイン等））

　あるいはボタンはすべて`⚙`一つにまとめる。ここをSPACEキー押下またはクリックすればボタン類が展開される。ただ、その場合は`⚙`ボタンが常時表示される。そうしないと開閉できないから。でもそれだと中のボタンを押したい時、二度手間になる。

```
+------------------+--+------------------+
|Textarea          |  |HtmlViewer        |
|                  |⚙ |                  |
|原稿を入力する    |  |原稿をHTML表示する|
+------------------+--|------------------+
```

　ボタンの配置については次の４パターン考えられる。

* ボタン中央配置
* ボタン表示ON/OFFをキーで切替（スマホ時操作不能）
* `⚙`ボタンに全ボタン収納（スマホ時二度手間）
* ボタンフォーカス時にESCキー押下するとTextareaにフォーカスする
* キーボードがあればキー切替、なければボタン中央配置

　最後のが理想。ただしキーボード有無判定は可能か？[Keyboard API][]なら可能か？それとも物理キーボード接続の判定はできない？

[Web API]:https://developer.mozilla.org/ja/docs/Web/API
[Keyboard API]:https://developer.mozilla.org/ja/docs/Web/API/Keyboard

# 機能

機能|概要
----|----
表示|書字方向切替（縦／横）、配色切替（白／黒）、フォント自動最適化
入力|Textarea、ファイルDnD、IndexedDB、URL
出力|Textarea、ファイルDL 、IndexedDB、URL

　入出力はTextareaとファイルのみ対応。それ以外はできれば対応。

# 追加

* メタデータ編集
    * タイトル、キャッチコピー、紹介文、ジャンル、セルフレイティング、シリーズ情報（何巻中何巻目、リンク、完結是非）
    * 著者名、URL
    * 文字数
    * uuid
* セクション編集（章立て）
* BeatSheet編集（ログライン、ピッチ、BeatSheetの15要素埋め）
* 入力
    * File（SQLite3）
    * IndexedDB
    * URL
        * 出力
        * Dropbox File
        * Dropbox FileRequest
* 出力
    * File（SQLite3）
    * IndexedDB
    * URL
        * Dropbox upload to self account directory
        * Dropbox upload to FileRequest

　不特定多数からテキストを受け取り、自動処理したい（通知、一覧画面作成、デプロイなど）。Dropbox FileRequestでは自動処理ができない。

　評価やコメントだけならSNSがよい。ユーザ特定するためにもSNSアカウントが欲しい。もしユーザ特定が不要ならテキストのみでOK。

# 遊び

* ゲームパッド文字入力（ソフトキーボード作成）
* BlueTooth入出力（サーバ不要マシン間データ送受信）

+--+--+--+--+--+
|あ|か|さ|た|な|
+--+--+--+--+--+
|は|ま|や|ら|わ|
+--+--+--+--+--+
|。|1 |6 |A |F |
+--+--+--+--+--+
|K |P |U |Z |😄|
+--+--+--+--+--+
改行,空白,BkSp,Del,カーソル移動


「」《》（）『』
。、！？…―
Abcde,fghij,klmno,pqrst,uvwxy,z.,!?


   +--+
   |い|
+--+--+--+
|お|あ|う|
+--+--+--+
   |え|
   +--+

1. あかさたな決定
2. あいうえお決定

　1で決定ボタンを押したまま十字キーを押すと「あ」以外を選択できる。十字キーを押さずに決定キーを離すと「あ」を選択する。

　L1で大文字・小文字を切替。
  L2で全角・半角を切替。
  R1でひらがな・カタカナを切替。
  R2でキーボードレイアウト切替。

# ユーザ識別したい

* このデータを作成したのは誰か？
* そのユーザが作成した他のデータは？

　このユーザは信用できる、といった判断ができるようにしたい。

# 特定ユーザ毎にいつも同じ値を返す

　UUIDは毎回異なる値を返すので対象外。同じデバイス内で毎回同じ値を返して欲しい。方法としてはSHA256を使う。引数にはfootprint値。たとえばMACアドレス。ただしMACアドレスはJSで取得できない。そこでグローバルIPアドレスを使う。

* https://zenn.dev/anozon/articles/csr-get-public-ip
* https://qiita.com/yutao727/items/0d503c45bcbe18b27ec3

```javascript
const API_URL = 'https://api.ipify.org/?format=json'
const res = await fetch(API_URL)
const data = await res.json()
console.log(data.ip)
```

　あるいはUUIDを作成し、それを使い回すようにすればよい。

　ユーザIDを作成したら、それを他ユーザから閲覧できないようにし、管理者だけが知れるようにすべき。さもないと成りすましが起きうる。ユーザが管理者に対していつも同じIDを使いつつ、IDはそれ以外で公開しない。

* ユーザ自身が所有するデバイスA内でユーザIDと作品を紐付ける
* ユーザ自身が所有するデバイスBにユーザIDと作品を共有する（異なるデバイスでも管理者からみて同一人物となるようにする）
* ユーザ以外の人になりすましされないようにする（ユーザIDを管理者以外に知らせない。管理者はユーザIDを誰にも知らせない）

　ユーザから管理者へユーザIDを渡す時、経由したサーバがあるとそのサーバ管理者に知られてしまう。

　P2PやBlueToothで通信すればサーバがないため傍受されにくい。ただしデバイス間が物理的に近いか、互いにグローバルIPアドレスを知っている必要がある。それは危険。

　何らかのWebServiceのアカウントIDを使ってSHA値にする。OAuth2でログインし、ユーザIDを取得し、それを元にSHA値を生成する。



# 作品を要約から順に書いていく

1. ログライン、ピッチ
2. BeatSheet
3. 設定（世界観、環境、歴史（事件）、人物）
4. 章立て（章毎に1〜3をして詳細化）
5. メタデータ（タイトル、キャッチコピー、紹介文など読者に見える要約）
6. 本文
7. Revision（diff+patch）
8. URLリンク（?Revision=1&BlockIndex=2&start=3&end=4&ReplaceText=置換後テキスト&Description=誤字・脱字・衍字・誤用）
9. PullRequest（GitHub API）
10. Update（GitHub API, Dropbox API, ...）
11. Update周知（Mastodon API）

```
タイトル      [            ] あとn字
キャッチコピー[            ] あとn字
紹介文        +------------+
              |            |
              +------------+ あとn字
ジャンル      [▼][▼][▼]
ｾﾙﾌﾚｲﾃｨﾝｸﾞ    [x][x][x]
属性          [A,B,C,D,...] あとn個
```


