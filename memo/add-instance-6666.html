<script src="../docs/lib/van/1.2.6/nomodule.min.js"></script>
<script src="../docs/lib/van-x/0.1.3/nomodule.min.js"></script>
<script src="../docs/lib/js-yaml/4.1.0/min.js"></script>
<script src="../docs/lib/util/type.js"></script>
<script>
const {div,span,h1,h2,p,br,em,ruby,rt,rp,textarea,button,input,table,tr,th,td,pre} = van.tags
window.addEventListener('DOMContentLoaded', async(event) => {
//    const InstanceList = () => {
    const InstanceList = (sname, initValues, addFn) => {
        //const items = vanX.reactive(JSON.parse(localStorage.getItem("appState") ?? "[]"))
        //const items = vanX.reactive([{domain:'mstdn.jp', isDel:false}])
        //const items = vanX.reactive([{domain:'mstdn.jp', isDel:false}])
        const items = vanX.reactive(((initValues) ? initValues.map(init=>({domain:init, isDel:false})) : [{domain:'mstdn.jp', isDel:false}]))
        //van.derive(() => localStorage.setItem("appState", JSON.stringify(items.filter(_ => 1))))
        const inputDom = input({type:'text',placeholder:'domain',size:6})
        const isValid = ()=>{
            console.log(inputDom.value, items)
            if (!inputDom.value.trim()) { console.warn('ç©ºå€¤ã§ã™ã€‚'); return false; } // ç©ºå€¤
            if (0 < WebService.ITEMS.filter(item=>item.name===sname)[0].instances.filter(ins=>ins.domain===inputDom.value).length) { console.warn('æ—¢å­˜ã§ã™ã€‚'); return false; } // æ—¢å­˜
            //if (0 < items.filter(item=>item.domain===inputDom.value).length) { console.warn('æ—¢å­˜ã§ã™ã€‚'); return false; } // æ—¢å­˜
            // ãƒªãƒ³ã‚¯åˆ‡ã‚Œç¢ºèªã‚‚ã—ãŸã„ãŒCORSåˆ¶ç´„ã«ã‚ˆã‚Šä¸å¯èƒ½â€¦
            return true
        }
        const addValue = ()=> {if (isValid()) {items.push({domain: inputDom.value, isDel: false}); addFn(inputDom.value); }}
        //const addValue = ()=> {if (isValid()) {items.push({domain: inputDom.value, isDel: false}); WebService.addInstance(sname, domain); }}
        /*
        const focus = ()=> {
            const si = WebService.ITEMS.findIndex(item=>item.name===sname)
            const s = WebService.ITEMS[si]
            if (!s.hasOwnProperty('instances')) { return }
            const ii = s.instances.findIndex(ins=>ins.domain===inputDom.value)
            document.querySelector(`#webservice-${si}-${ii}`).focus()
        }
        return div(inputDom,button({onclick:()=>{addValue();focus();}}, 'ï¼‹'))
        */
        return div(inputDom,button({onclick:()=>addValue()}, 'ï¼‹'))
    }
//    van.add(document.body, InstanceList(['pawoo.net'], (domain)=>console.log(`${domain}è¿½åŠ `)))
//    van.add(document.body, InstanceList(['misskey.com'], (domain)=>console.log(`${domain}è¿½åŠ ã ãƒ¼ã‚ˆ`)))
    /*
    van.add(document.body, InstanceList('Mastodon', ['pawoo.net'], (domain)=>{WebService.addInstance('Mastodon', domain);console.log(WebService.getService('Mastodon').instances);}))
    van.add(document.body, InstanceList('Misskey', ['misskey.com'], (domain)=>{WebService.addInstance('Misskey', domain);console.log(WebService.getService('Misskey').instances);}))
    */

;
//    van.add(document.body, InstanceList)

/*
    function makeInstanceList(initValues) {
        //const items = vanX.reactive([{domain:'mstdn.jp', isDel:false}])
        const items = vanX.reactive(((initValues) ? initValues.map(init=>({domain:init, isDel:false})) : [{domain:'mstdn.jp', isDel:false}]))
        const inputDom = input({type:'text',placeholder:'domain'})
        const isValid = ()=>{
            console.log(inputDom.value, items)
            if (!inputDom.value.trim()) { console.warn('ç©ºå€¤ã§ã™ã€‚'); return false; } // ç©ºå€¤
            if (0 < items.filter(item=>item.domain===inputDom.value).length) { console.warn('æ—¢å­˜ã§ã™ã€‚'); return false; } // æ—¢å­˜
            // ãƒªãƒ³ã‚¯åˆ‡ã‚Œç¢ºèªã‚‚ã—ãŸã„ãŒCORSåˆ¶ç´„ã«ã‚ˆã‚Šä¸å¯èƒ½â€¦
            return true
        }
        const addValue = ()=> {if (isValid()) {items.push({domain: inputDom.value, isDel: false})}}
        const swap = (i, k)=> {
            const tmp = items[k]
            items[k] = items[i]
            items[i] = tmp
        }
        return div(inputDom,
            button({onclick:()=>addValue()}, 'ï¼‹'),
            vanX.list(div, items, ({val: v}, deleter) => div(
                input({type: 'checkbox', checked: () => v.isDel, onclick: e => v.isDel = e.target.checked}),
                () => (v.isDel ? van.tags.strike : span)(v.domain),
                van.tags.a({href:()=>`https://${v.domain}/`,style:'text-decoration:none;'}, 'ğŸ”—'),
                van.tags.a({onclick:deleter, style:'cursor:pointer;'}, 'âŒ'),
            )),
        )
    }
//    van.add(document.body, makeInstanceList())
//    van.add(document.body, makeInstanceList('misskey.com'))
//    van.add(document.body, ()=>makeInstanceList())
//    van.add(document.body, ()=>makeInstanceList(['misskey.com']))
    */









    class AuthorState {
        constructor() {
            this.name = van.state('')
            this.cryptos = CryptoAssets.reactive()
            this.services = WebService.reactive()
            console.log(this.cryptos)
            console.log(this.services)
//            this.dates = dates
//            this.uuid = null
        }
        get htmls() { return [
            p(this.name),
            p(()=>div(this.services)),
            p(()=>div(this.cryptos)),
        ]}
        get yaml() { return jsyaml.dump({'author':{name:this.name.val, ...this.#webServiceYaml, ...this.#cryptoAssetsYaml}}) }
        get #webServiceYaml() { // å€¤ãŒã‚ã‚‹ã‚­ãƒ¼ã®ã¿å¯¾è±¡ã«ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä½œã‚Šç›´ã™
            const obj = {}
            for (let key of Object.keys(this.services).sort()) {
                if      (''===this.services[key]) { continue }
                else if (Type.isString(this.services[key])) { obj[key] = this.services[key] }
                else if (Type.isObject(this.services[key])) {
                    obj[key] = {}
                    for (let insId of Object.keys(this.services[key])) {
                        if (this.services[key][insId]) {
                            obj[key][insId] = this.services[key][insId]
                        }
                    }
                    if (0===Object.keys(obj[key]).length) { delete obj[key] }
                }
            }
            return ((0===Object.keys(obj).length) ? ({}) : ({service:obj}))
        }
        get #copy() {
            const obj = {}
            JSON.parse(JSON.stringify(this.services))
        }
        get #cryptoAssetsYaml() {
            const obj = {}
            //for (let key of Object.keys(this.services)) {
            for (let key of Object.keys(this.cryptos).sort()) {
                if (this.cryptos[key]) { obj[key] = this.cryptos[key] }
            }
            return ((0===Object.keys(obj).length) ? ({}) : ({cryptos:obj}))
        }
    }
    /*
        class Domain {
            constructor(domain) {
                this._domain = domain
            }
            get domain() { return this._domain }
            get url() { return {
                top: `https://${this.domain}/`,
                userPage: `https://${this.domain}/`+'@{{account.name}}',
            }}
        }
    */
    class WebService {
        static ITEMS = [
            {index:0, category:'hosting', name:'GitHub', url:{domain:'github.com', top:'https://github.com/', userPage:`{{account.name}}`}},
            {index:1, category:'sns', name:'Mastodon', url:{wikipedia:'https://ja.wikipedia.org/wiki/%E3%83%9E%E3%82%B9%E3%83%88%E3%83%89%E3%83%B3_(%E3%83%9F%E3%83%8B%E3%83%96%E3%83%AD%E3%82%B0)'}, instances:vanX.reactive([
                {index:0, domain:'mstdn.jp', top:'https://mstdn.jp/', userPage:`@{{account.name}}`},
                {index:1, domain:'mastodon-japan.net', top:'https://mastodon-japan.net/', userPage:`@{{account.name}}`},
            ])},
            {index:2, category:'sns', name:'Misskey', url:{wikipedia:'https://ja.wikipedia.org/wiki/Misskey'}, instances:vanX.reactive([
                {index:0, domain:'nijimiss.moe', top:'https://nijimiss.moe/', userPage:`@{{account.name}}`},
                {index:1, domain:'misskey-square.net', top:'https://misskey-square.net/', userPage:`@{{account.name}}`},
            ])},
        ]
        //static getService(name) { return WebService.ITEMS.filter(item=>item.name.toLowerCase()===name.toLowerCase()) }
        static getService(name) { console.log(name, WebService.ITEMS[0].name);return WebService.ITEMS.filter(item=>item.name.toLowerCase()===name.toLowerCase())[0] }
        static getInstance(name, domain) { return this.getService(name).instances.filter(ins=>ins.domain===domain) }
        static addInstance(name, domain) { this.#addService(name); const s=this.getService(name); console.log(s, s.instances); return s.instances.push({'index':s.instances.length, 'domain':domain, 'top':`https://${domain}/`, 'userPage':`@{{account.name}}`, 'isDel':false}); }
        static #addService(name) { return this.ITEMS.push(({'index':this.ITEMS.length, 'name':name, 'category':'sns', 'url':{'wikipedia':''}, 'instances':[]})) }
        static deleteInstance(name, domain) {const s=this.getService(name); const i=s.instances.findIndex(ins=>ins.domain===domain); s.instances.splice(i, 1); console.log('deleteInstance', name, domain, i);}
        //static reactive() { // vanX.reactive({Service-Instance:User, ...})
        static reactive() { // vanX.reactive({Service:User, Service:{Instance:User,...}, ...})
            const obj = {}
            //const getKeys = (item)=>((item.hasOwnProperty('instances') ? item.instances.map(ins=>`${item.name}-${item.name}`) : [item.name]))
            const getKeys = (item)=>item.name
            const keys = this.ITEMS.map(item=>getKeys(item)).flat().map(k=>k.toLowerCase())
            console.log(keys)
//            for (let k of keys) { obj[k] = '' }
            for (let k of keys) {
                obj[k] = ''
                const conds = this.ITEMS.filter(item=>item.hasOwnProperty('instances') && k===item.name.toLowerCase())
                if (conds.length < 1) { continue }
                obj[k] = {}
                for (let ins of conds[0].instances) { Object.assign(obj[k], ({[ins.domain]: ''})) }
            }
            console.log(obj)
            return vanX.reactive(obj)
        }
        static make(meta) { return table(this.#trs(meta)) }
        static #trs(meta) { return WebService.ITEMS.map((item,i)=>((item.hasOwnProperty('instances')) ? this.#hasInstanceTrs(meta,item, i) : this.#tr(meta,item, i))) }
        static #tr(meta,item, i) { return [
            th({colspan:2},van.tags.label(van.tags.a({href:item.url.top, target:'_blank', rel:'noopener noreferrer'}, item.name))), 
            td(van.tags.input({id:`webservice-${i}`, placeholder:'ãƒ¦ãƒ¼ã‚¶åã‚„è­˜åˆ¥å­', oninput:(e)=>{
                const selecteds = WebService.ITEMS.filter(item=>i===item.index)
                console.log(selecteds)
                if (1!==selecteds.length) { console.warn('WebServiceã®ã‚­ãƒ¼å€™è£œãŒ1ã¤ä»¥å¤–ã§ä¸æ­£ãªã®ã§ä¸­æ–­ã—ã¾ã™ã€‚'); }
//                const key = selecteds[0].name.toLowerCase()
                const key = this.#yamlKey(selecteds[0])
                console.log(`key: ${key}`)
                meta.author.services[key] = e.target.value
                console.log(`${key}: ${meta.author.services[key]}`)
            }}))
        ]}
//        static #hasInstanceTrs(meta,item,i) { return item.instances.map((ins,k)=>tr(this.#instanceTrContents(meta,item,i,ins,k))) }
        static #hasInstanceTrs(meta,item,i) { return [
            tr(th({rowspan:item.instances.length},
                    van.tags.label(van.tags.a({href:item.url.wikipedia, target:'_blank', rel:'noopener noreferrer'}, item.name)),
                    van.tags.br(),
                    InstanceList(...(('Mastodon'===item.name) ? ['Mastodon', [], (domain)=>{WebService.addInstance('Mastodon', domain);console.log(WebService.getService('Mastodon').instances);}] : ['Misskey', [], (domain)=>{WebService.addInstance('Misskey', domain);console.log(WebService.getService('Misskey').instances);}])),), td(
                            InstanceList(...(('Mastodon'===item.name) ? ['Mastodon', [], (domain)=>{WebService.addInstance('Mastodon', domain);console.log(WebService.getService('Mastodon').instances);}] : ['Misskey', [], (domain)=>{WebService.addInstance('Misskey', domain);console.log(WebService.getService('Misskey').instances);}])),
            //                van.tags.label(van.tags.a({href:ins.top, target:'_blank', rel:'noopener noreferrer'}, ins.domain)), 
            //                ((ins.hasOwnProperty('isDel')) ? van.tags.a({onclick:()=>{console.log('DEL');ins.isDel=true;}}, 'âœ–') : '')
                        ),td())
            ...item.instances.map((ins,k)=>tr(this.#instanceTrContents(meta,item,i,ins,k))),
            
        ] }
        /*
        */
        static #instanceTrContents(meta, item, i, ins, k) {
            const contens = []
            //if (0===k) { contens.push(th({rowspan:item.instances.length},van.tags.label(van.tags.a({href:item.url.wikipedia, target:'_blank', rel:'noopener noreferrer'}, item.name)))) }
            if (0===k) {
                //contens.push(th({rowspan:item.instances.length+1},
                contens.push(th({rowspan:item.instances.length},
                    van.tags.label(van.tags.a({href:item.url.wikipedia, target:'_blank', rel:'noopener noreferrer'}, item.name)),
                    van.tags.br(),
                    InstanceList(...(('Mastodon'===item.name) ? ['Mastodon', [], (domain)=>{WebService.addInstance('Mastodon', domain);console.log(WebService.getService('Mastodon').instances);}] : ['Misskey', [], (domain)=>{WebService.addInstance('Misskey', domain);console.log(WebService.getService('Misskey').instances);}])),
                ))
            }
            if (ins.isDel) { return contens }
            //contens.push(th(van.tags.label(van.tags.a({href:ins.top, target:'_blank', rel:'noopener noreferrer'}, ins.domain))))
            contens.push(th(
                van.tags.label(van.tags.a({href:ins.top, target:'_blank', rel:'noopener noreferrer'}, ins.domain)), 
                ((ins.hasOwnProperty('isDel')) ? van.tags.a({onclick:()=>{console.log('DEL');ins.isDel=true;},onkeydown:e=>{if(' '===e.key){e.preventDefault()}ins.isDel=true;console.log('aXXXXXXXXX');},tabindex:0}, 'âœ–') : '')))
            contens.push(td(van.tags.input({id:`webservice-${i}-${k}`, placeholder:'ãƒ¦ãƒ¼ã‚¶åã‚„è­˜åˆ¥å­', oninput:(e)=>{
                    const selected = WebService.ITEMS.filter(item=>i===item.index)[0]
                    const serviceId = selected.name.toLowerCase()
                    const instanceId = selected.instances[k].domain.toLowerCase()
                    meta.author.services[`${serviceId}`][`${instanceId}`] = e.target.value;
                    console.log(e, e.target.value, i, serviceId, instanceId, meta.author.services[`${serviceId}`][`${instanceId}`]);
//            }}, ((ins.hasOwnProperty('isDel')) ? van.tags.a({onclick:()=>ins.isDel}, 'âœ–') : ''))))
            }})))
//            console.log('xxxxxxxxxxxxxxxxxxxxxx:', ins, ins.hasOwnProperty('isDel'), ((ins.hasOwnProperty('isDel')) ? van.tags.a({onclick:()=>ins.isDel}, 'âœ–') : ''))
            return contens
       }
       static #yamlKey(service, instance) { return `${service.name}${((instance) ? '-'+instance.domain.replace('.','-') : '')}`.toLowerCase() }
    }
    class CryptoAssets {
        static ITEMS = [
            {index:0, abbr:'MONA', url:'https://ja.wikipedia.org/wiki/Monacoin'},
            {index:1, abbr:'BTC', url:'https://ja.wikipedia.org/wiki/%E3%83%93%E3%83%83%E3%83%88%E3%82%B3%E3%82%A4%E3%83%B3'},
            {index:2, abbr:'LTC', url:'https://ja.wikipedia.org/wiki/%E3%83%A9%E3%82%A4%E3%83%88%E3%82%B3%E3%82%A4%E3%83%B3'},
            {index:3, abbr:'ETH', url:'https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%AA%E3%82%A2%E3%83%A0'},
            {index:4, abbr:'SOL', url:'https://en.wikipedia.org/wiki/Solana_(blockchain_platform)'},
            {index:5, abbr:'DOGE', url:'https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%BC%E3%82%B8%E3%82%B3%E3%82%A4%E3%83%B3'},
        ]
        constructor(type, address) {
            this.type = type
            this.address = address
        }
        static make(meta) { return table(this.#trs(meta)) }
        static #trs(meta) { return this.ITEMS.map((item,i)=>tr(
            th(van.tags.label(van.tags.a({href:item.url, target:'_blank', rel:'noopener noreferrer'}, item.abbr))), 
            //td(van.tags.input({id:`crypto-assets-${i}`, placeholder:'ã‚¢ãƒ‰ãƒ¬ã‚¹', oninput:(e)=>meta.author.cryptoAssets[i].address.val = e.target.value}))
            td(van.tags.input({id:`crypto-assets-${i}`, placeholder:'ã‚¢ãƒ‰ãƒ¬ã‚¹', oninput:(e)=>{
                console.log(meta.author.cryptoAssets)
                meta.author.cryptos[item.abbr.toLowerCase()] = e.target.value
            }}))
        ))}
        static reactive() { // vanX.reactive({Abbr:Address, ...})
            const obj = {}
            for (let item of this.ITEMS) { obj[item.abbr] = '' }
            return vanX.reactive(obj)
        }
    }
    class Dates {
        constructor(created, published, updated, expiration) {
            this.created = ((created) ? created : new Date())
            this.published = published
            this.updated = updated
            this.expiration = expiration
        }
        ymdhms(d,s1='-',s2=' ',s3=':') { return `${this.ymd(d, s1)}${s2}${this.hms(d, s3)}` }
        ymd(d,s='-') { return `${d.getFullYear()}${s}${d.getMonth()+1}${s}${d.getDate()}` }
        hms(d,s=':') { return `${d.getHours()}${s}${d.getMinutes()}${s}${d.getSeconds()}` }
        md(d,s='-') { return `${d.getMonth()+1}${s}${d.getDate()}` }
        hm(d,s=':') { return `${d.getHours()}${s}${d.getMinutes()}${s}${d.getSeconds()}` }
        ms(d,s=':') { return `${d.getHours()}${s}${d.getMinutes()}${s}${d.getSeconds()}` }
    }
    class Revision {
        constructor(ver, created, patch, summary) {
            this.version = ver
            this.created = created
            this.patch = patch
            this.summary = summary
        }
    }
    class SelectElement {
        constructor(label, items, setFn, selectedIndex=0) {
            this._label = label
            this._items = items
            this._setFn = setFn
            this._selected = van.state(selectedIndex)
            this._summary = van.derive(()=>this._items[this._selected.val].summary)
            this._comment = van.derive(()=>this._items[this._selected.val].comment)
            this._details = van.derive(()=>this._items[this._selected.val].details)
        }
        get label() { return this._label }
        make(meta) { return div(van.tags.select({title:()=>this._comment.val, onchange:(e)=>{
            console.log(this._selected.val);
            this._selected.val = e.target.value
            this._setFn(meta, this.selectedItem) // meta.genre = this.selectedItem.name
        //}}, this.#options), span(this._summary)) }
        }}, this.#options), van.tags.details({style:'display:inline-block;'},van.tags.summary(this._summary), this._details)) }
        get #options() { return this._items.map((item,i)=>van.tags.option({title:item.summary, value:i}, item.name)) }
        get selectedItem() { return this._items[this._selected.val] }
    }
    const Category = new SelectElement('ã‚«ãƒ†ã‚´ãƒª', [
        {name: 'æ–‡å­¦', summary:'äººé–“ã®é†œã•ã‚„æ‚²åŠ‡ã‚’æã„ãŸå°èª¬ã€‚', comment:'èŠ¸è¡“æ€§ã‚’é‡è¦–', details:'ç´”æ–‡å­¦ã€‚å­¦å•ã§ãªã„æ•£æ–‡ã§ã€èŠ¸è¡“æ€§ã®ã‚ã‚‹æ–‡ç« ã€‚'},
        {name: 'ä¸€èˆ¬æ–‡èŠ¸', summary:'ç‰©èªã®é¢ç™½ã•ã‚’è¿½æ±‚ã—ãŸå°èª¬ã€‚', comment:'å¨¯æ¥½æ€§ã‚’é‡è¦–', details:'å¤§è¡†æ–‡å­¦ã€‚æ–‡å­¦ã‚ˆã‚Šã‚‚å¨¯æ¥½æ€§ã‚’é‡è¦–ã—ãŸæ–‡ç« ã€‚'},
        {name: 'ãƒ©ã‚¤ãƒˆæ–‡èŠ¸', summary:'ç¾å®Ÿå‘³ã®ã‚ã‚‹ãƒ©ã‚¤ãƒˆãƒãƒ™ãƒ«å°èª¬ã€‚', comment:'å¤§äººç”¨ãƒ©ãƒãƒ™', details:'å¤§äººç”¨ãƒ©ãƒãƒ™ã€‚ä¸€èˆ¬æ–‡èŠ¸ï¼‹ãƒ©ã‚¤ãƒˆãƒãƒ™ãƒ«ã€‚ãƒ©ãƒãƒ™ã¨åŒæ§˜ã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å£²ã‚Šã«ã—ã¤ã¤ã€ã‚ˆã‚Šç¾å®Ÿå‘³ãŒã‚ã‚‹æ–‡ç« ã€‚'},
        {name: 'ãƒ©ã‚¤ãƒˆãƒãƒ™ãƒ«', summary:'ç™»å ´äººç‰©ã®é¢ç™½ã•ã‚’è¿½æ±‚ã—ãŸå°èª¬ã€‚', comment:'æ€æ˜¥æœŸå‘ã‘ã€‚éç¾å®Ÿçš„ãªè¨­å®šã€‚å¹³æ˜“ãªæ–‡ä½“ã€‚', details:'æ€æ˜¥æœŸå‘ã‘ã€‚éç¾å®Ÿçš„ãªè¨­å®šã€‚å¹³æ˜“ãªæ–‡ä½“ã€‚ãƒãƒƒãƒ”ãƒ¼ã‚¨ãƒ³ãƒ‰ã€‚å¤šå¹¸æ„Ÿã€‚ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒªãƒ¼ã€‚é ­ã‚’ç©ºã£ã½ã«ã—ã¦ã‚¹ãƒ©ã‚¹ãƒ©èª­ã‚ã‚‹ã€‚ä¸å¿«ãªå±•é–‹ãŒãªãå¿«æ„Ÿã°ã‹ã‚Šã€‚'},
        {name: 'å…ç«¥', summary:'12æ­³ä»¥ä¸‹ã®å…ç«¥å‘ã‘å°èª¬ã€‚', comment:'å­ä¾›ç”¨å°èª¬', details:''},
    ], (meta,item)=>meta.category=item.name)
    const Genre = new SelectElement('ã‚¸ãƒ£ãƒ³ãƒ«', [
        {name: 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', summary:'å‰£ãƒ»é­”æ³•ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³ç­‰ãŒå­˜åœ¨ã™ã‚‹ä¸–ç•Œã§ã®å†’é™ºè­šã€‚', comment: '', details:''},
        {name: 'SF', summary:'ç§‘å­¦çš„æ ¹æ‹ ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸç‰©èªã€‚', comment: 'èª°ãŒçŠ¯äººã‹ã€ã©ã‚“ãªæ‰‹å£ã‹ã€å‹•æ©Ÿã¯ä½•ã‹ã€‚', details:''},
        {name: 'æ¨ç†', summary:'è¬è§£ããŒä¸»é¡Œã®å°èª¬ã€‚', comment: '', details:''},
        {name: 'ãƒ›ãƒ©ãƒ¼', summary:'ææ€–ãŒä¸»é¡Œã®å°èª¬ã€‚', comment: 'æ€ªè«‡ã€å¹½éœŠã€å¦–æ€ªã€å‘ªã„ã€ã‚¾ãƒ³ãƒ“ã€ã‚¦ã‚¤ãƒ«ã‚¹ã€ãƒ‘ãƒ‹ãƒƒã‚¯', details:''},
        {name: 'æ‹æ„›', summary:'æ‹æ„›ã‚’ä¸»è»¸ã«ãŠã„ãŸç‰©èªã€‚', comment: '', details:''},
        {name: 'é’æ˜¥', summary:'å­¦ç”ŸãŒä¸»äººå…¬ã®ç‰©èªã€‚', comment: '', details:''},
        {name: 'æ­´å²/æ™‚ä»£', summary:'æ­´å²ã‚’ç‰©èªã«ã—ãŸå°èª¬ã€‚', comment: 'å²å®Ÿâ†’"æ­´å²"ï¼å‰µä½œâ†’"æ™‚ä»£"', details:''},
        {name: 'çµŒæ¸ˆ', summary:'çµŒæ¸ˆã®ä»•çµ„ã¿ã‚„åŠ´åƒå•é¡Œã‚’æ‰±ã†ç‰©èªã€‚', comment: '', details:''},
        {name: 'æ”¿æ²»', summary:'æ”¿æ²»çš„å‡ºæ¥äº‹ã‚’æ‰±ã£ãŸç‰©èªã€‚', comment: '', details:''},
        {name: 'å®˜èƒ½', summary:'æ€§æå†™ãŒä¸»é¡Œã®å°èª¬ã€‚', comment: '', details:''},
        {name: 'ãƒãƒ³ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³', summary:'äº‹å®Ÿã«åŸºã¥ã„ãŸç‰©èªã€‚', comment: '', details:''},
        {name: 'éšç­†', summary:'è¦‹èãƒ»æ€ç´¢ãƒ»æ„Ÿæƒ³ãªã©ã‚’æ°—ã¾ã¾ã«è¨˜ã—ãŸæ–‡ç« ã€‚', comment: 'ã‚¨ãƒƒã‚»ã‚¤ã€æ—¥è¨˜ã€é›‘è¨˜ã€ç§å°èª¬', details:'è©±ã®ç­‹é“ãŒæ•´åˆçš„ãªä½“ç³»ã«å›åã•ã‚Œã¦ã—ã¾ã†ã“ã¨ã‚’ä½•ã‚ˆã‚Šå¿Œé¿ã—ã¦ã€è¤‡æ•°ã®è«–ç†ã‚„æ–­ç‰‡çš„ãªæ€è€ƒã«ç©æ¥µçš„ã«èº«ã‚’ä»»ã›ã€è„±ç·šã‚„é€¸è„±ã‚„é€¡å·¡ã‚’ã„ã¨ã‚ãªã„ã€‚å®‰ç›´ãªå…¨ä½“åŒ–ã«åŸ·æ‹—ã«æŠµæŠ—ã™ã‚‹ã€ãã‚“ãªè‡ªç”±ãªæ€è€ƒã®ã€Œè©¦ã¿ã€ã«ã“ãã€ã‚¨ãƒƒã‚»ã‚¤ã¨ã„ã†ã‚¸ãƒ£ãƒ³ãƒ«ã®æœ¬è³ªãŒã‚ã‚‹ã€‚'},
    ], (meta,item)=>meta.genre=item.name)

    console.log(CryptoAssets.ITEMS)
    class WorkState {
        constructor(title, catchCopy, intro, category, genre) {
            this.title = title
            this.catch = catchCopy
            this.intro = intro
            this.category = category // å°èª¬ï¼ˆæ–‡å­¦ã€ä¸€èˆ¬æ–‡èŠ¸ã€ãƒ©ã‚¤ãƒˆæ–‡èŠ¸ã€ãƒ©ã‚¤ãƒˆãƒãƒ™ãƒ«ã€å…ç«¥ï¼‰
            this.genre = genre // ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ã€SFã€æ¨ç†ã€ãƒ›ãƒ©ãƒ¼ã€æ‹æ„›ã€é’æ˜¥ã€æ­´å²ã€çµŒæ¸ˆã€æ”¿æ²»ã€å®˜èƒ½ã€éšç­†ã€ãƒãƒ³ãƒ•ã‚£ã‚¯ã‚·ãƒ§ãƒ³
        }
        get htmls() { return [
            h1(this.title),
            h2(this.catch),
            p(this.category),
            p(this.genre),
        ]}
        get yaml() { return jsyaml.dump({title:this.title, catch:this.catch, intro:this.intro, category:this.category, genre:this.genre}) }
        //get yaml() { return jsyaml.dump({title:this.title, catch:this.catch, intro:this.intro, category:this.category, genre:this.genre, author:{'name':this.author.name }}) }
    }
    class Meta {
        constructor(title, catchCopy, intro, category, genre) {
            this.work = vanX.reactive(new WorkState(title, catchCopy, intro, category, genre))
            this.author = new AuthorState()
//            this.cryptos = CryptoAssets.reactive()
//            this.services = WebService.reactive()
        }
        get htmls() { return [
            h1(this.work.title),
            h2(this.work.catch),
            p(this.work.intro),
            p(this.work.category),
            p(this.work.genre),
            p(this.author.name),
            p(Object.entries(this.author.services).join(',')),
            p(Object.entries(this.author.cryptos).join(',')),
//            p(()=>div(this.author.webServices.map((item,i)=>`${WebService.ITEMS[i].name}:${item.username.val}`))),
//            p(()=>div(this.author.cryptoAssets.map((item,i)=>`${CryptoAssets.ITEMS[i].abbr}:${item.address.val}`))),
        ]}
        //get yaml() { return `---\n${jsyaml.dump({title:this.title, catch:this.catch, intro:this.intro, category:this.category, genre:this.genre, author:{'name':this.author.name }})}---` }
        get yaml() { return `---\n${this.work.yaml}${this.author.yaml}---` }
        get #webServiceYaml() { return this.author.webServices.filter(item=>item.username.val).map(item=>{
            console.log(item);
            return ({'type':WebService.ITEMS[item.index].name, 'address':item.username.val});
        }) }
    }
    const meta = new Meta('ã‚¿ã‚¤ãƒˆãƒ«', 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼', 'ç´¹ä»‹æ–‡', Category.selectedItem.name, Genre.selectedItem.name)
    console.log(Object.keys(meta))
    console.log(Object.getOwnPropertyDescriptor(meta, "property"))
    van.add(document.body, div(div(table(
        tr(th('ã‚¿ã‚¤ãƒˆãƒ«'), td(input({placeholder:'ã‚¿ã‚¤ãƒˆãƒ«',value:'ã‚¿ã‚¤ãƒˆãƒ«',oninput:(e)=>meta.work.title=e.target.value}))), 
        tr(th('ï½·ï½¬ï½¯ï¾ï½ºï¾‹ï¾Ÿï½°'), td(input({placeholder:'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼',value:'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼',oninput:(e)=>meta.work.catch=e.target.value}))), 
        tr(th('ç´¹ä»‹æ–‡'), td(input({placeholder:'ç´¹ä»‹æ–‡',value:'ç´¹ä»‹æ–‡',oninput:(e)=>meta.work.intro=e.target.value}))), 
        tr(th(Category.label), td(()=>Category.make(meta.work))), 
        tr(th(Genre.label), td(()=>Genre.make(meta.work))), 
    //)), div(()=>div(meta.htmls)), pre(()=>meta.yaml)))
    ))))
    van.add(document.body, div(div(table(
        tr(th('è‘—è€…å'), td(input({placeholder:'å±±ç”°ã€Šã‚„ã¾ã ã€‹å¤ªéƒã€ŠãŸã‚ã†ã€‹',value:'å±±ç”°ã€Šã‚„ã¾ã ã€‹å¤ªéƒã€ŠãŸã‚ã†ã€‹',oninput:(e)=>meta.author.name.val=e.target.value}))), 
//        tr(th('å¤–éƒ¨'), td(WebService.make(meta.author))),
//        tr(th('æš—å·é€šè²¨'), td(CryptoAssets.make(meta.author))), 
//        tr(th('å¤–éƒ¨'), td(WebService.make(meta))),
//        tr(th('æš—å·é€šè²¨'), td(CryptoAssets.make(meta))), 
        tr(th('å¤–éƒ¨'), td(()=>WebService.make(meta))),
        tr(th('æš—å·é€šè²¨'), td(()=>CryptoAssets.make(meta))), 
    //)), div(()=>div(meta.author.htmls)), pre(()=>meta.author.yaml)))
    ))))
    van.add(document.body, div(()=>div(meta.htmls)), pre(()=>meta.yaml))
})
</script>

